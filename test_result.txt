
> yusystem@0.1.0 test
> jest --coverage

FAIL __tests__/utils/permissions.test.ts
  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for null/undefined user

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 12 |[39m     describe([32m'hasPermission'[39m[33m,[39m () [33m=>[39m {
     [90m 13 |[39m         it([32m'returns false for null/undefined user'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 14 |[39m             expect(hasPermission([36mnull[39m[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                             [31m[1m^[22m[39m
     [90m 15 |[39m             expect(hasPermission(undefined[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 16 |[39m         })[33m;[39m
     [90m 17 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:14:61)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for inactive user

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 17 |[39m
     [90m 18 |[39m         it([32m'returns false for inactive user'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 19 |[39m             expect(hasPermission({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mfalse[39m }[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                           [31m[1m^[22m[39m
     [90m 20 |[39m         })[33m;[39m
     [90m 21 |[39m
     [90m 22 |[39m         it([32m'admin has full permissions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:19:91)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ worker has limited permissions

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 30 |[39m             [36mconst[39m worker [33m=[39m { role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m;[39m
     [90m 31 |[39m             expect(hasPermission(worker[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 32 |[39m             expect(hasPermission(worker[33m,[39m [32m'projects'[39m[33m,[39m [32m'edit'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                               [31m[1m^[22m[39m
     [90m 33 |[39m             expect(hasPermission(worker[33m,[39m [32m'estimates'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 34 |[39m         })[33m;[39m
     [90m 35 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:32:63)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for unknown role

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 35 |[39m
     [90m 36 |[39m         it([32m'returns false for unknown role'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 37 |[39m             expect(hasPermission({ role[33m:[39m [32m'unknown'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                            [31m[1m^[22m[39m
     [90m 38 |[39m         })[33m;[39m
     [90m 39 |[39m     })[33m;[39m
     [90m 40 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:37:92)

  ‚óè permissions ‚Ä∫ canAccessProject ‚Ä∫ worker needs assigned projects

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 49 |[39m             [36mconst[39m worker [33m=[39m { role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m[33m,[39m assignedProjects[33m:[39m [[32m'proj-1'[39m[33m,[39m [32m'proj-2'[39m] }[33m;[39m
     [90m 50 |[39m             expect(canAccessProject(worker[33m,[39m [32m'proj-1'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 51 |[39m             expect(canAccessProject(worker[33m,[39m [32m'proj-3'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 52 |[39m         })[33m;[39m
     [90m 53 |[39m
     [90m 54 |[39m         it([32m'worker without assignedProjects returns false'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:51:56)

  ‚óè permissions ‚Ä∫ canAccessProject ‚Ä∫ worker without assignedProjects returns false

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 53 |[39m
     [90m 54 |[39m         it([32m'worker without assignedProjects returns false'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 55 |[39m             expect(canAccessProject({ role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m,[39m [32m'proj-1'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                    [31m[1m^[22m[39m
     [90m 56 |[39m         })[33m;[39m
     [90m 57 |[39m     })[33m;[39m
     [90m 58 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:55:84)

  ‚óè permissions ‚Ä∫ canDispatch ‚Ä∫ foreman2/worker cannot dispatch

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 65 |[39m
     [90m 66 |[39m         it([32m'foreman2/worker cannot dispatch'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 67 |[39m             expect(canDispatch({ role[33m:[39m [32m'foreman2'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                       [31m[1m^[22m[39m
     [90m 68 |[39m             expect(canDispatch({ role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 69 |[39m         })[33m;[39m
     [90m 70 |[39m     })[33m;[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:67:71)

  ‚óè permissions ‚Ä∫ isManagerOrAbove ‚Ä∫ only admin and manager return true

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 74 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 75 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'manager'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'foreman1'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                            [31m[1m^[22m[39m
     [90m 77 |[39m         })[33m;[39m
     [90m 78 |[39m     })[33m;[39m
     [90m 79 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:76:76)

  ‚óè permissions ‚Ä∫ isAdmin / canManageUsers ‚Ä∫ only active admin returns true

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 81 |[39m         it([32m'only active admin returns true'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m             expect(isAdmin({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 83 |[39m             expect(isAdmin({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mfalse[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                 [31m[1m^[22m[39m
     [90m 84 |[39m             expect(isAdmin({ role[33m:[39m [32m'manager'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 85 |[39m             expect(canManageUsers({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 86 |[39m         })[33m;[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:83:65)

  ‚óè permissions ‚Ä∫ getRoleDisplayName ‚Ä∫ returns Japanese role names

    TypeError: (0 , _permissions.getRoleDisplayName) is not a function

    [0m [90m 89 |[39m     describe([32m'getRoleDisplayName'[39m[33m,[39m () [33m=>[39m {
     [90m 90 |[39m         it([32m'returns Japanese role names'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 91 |[39m             expect(getRoleDisplayName([32m'admin'[39m))[33m.[39mtoBe([32m'ÁÆ°ÁêÜËÄÖ'[39m)[33m;[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 92 |[39m             expect(getRoleDisplayName([32m'manager'[39m))[33m.[39mtoBe([32m'„Éû„Éç„Éº„Ç∏„É£„Éº'[39m)[33m;[39m
     [90m 93 |[39m             expect(getRoleDisplayName([32m'foreman1'[39m))[33m.[39mtoBe([32m'ËÅ∑Èï∑1'[39m)[33m;[39m
     [90m 94 |[39m             expect(getRoleDisplayName([32m'foreman2'[39m))[33m.[39mtoBe([32m'ËÅ∑Èï∑2'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/utils/permissions.test.ts:91:38)

FAIL __tests__/lib/api/utils.test.ts
  ‚óè API Utils ‚Ä∫ requireAuth ‚Ä∫ should return error when no session

    expect(received).toBeNull()

    Received: {"user": {"id": "user-1", "isActive": true, "role": "manager"}}

    [0m [90m 59 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAuth()[33m;[39m
     [90m 60 |[39m
    [31m[1m>[22m[39m[90m 61 |[39m             expect(result[33m.[39msession)[33m.[39mtoBeNull()[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 62 |[39m             expect(result[33m.[39merror)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m
     [90m 63 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m 64 |[39m                 { error[33m:[39m [32m'Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô'[39m }[33m,[39m[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:61:36)

  ‚óè API Utils ‚Ä∫ requireAuth ‚Ä∫ should return session when authenticated

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 2

      Object {
        "user": Object {
          "id": "user-1",
    -     "role": "admin",
    +     "isActive": true,
    +     "role": "manager",
        },
      }

    [0m [90m 73 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAuth()[33m;[39m
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m             expect(result[33m.[39msession)[33m.[39mtoEqual(mockSession)[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 76 |[39m             expect(result[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m
     [90m 77 |[39m         })[33m;[39m
     [90m 78 |[39m     })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/api/utils.test.ts:75:36)

  ‚óè API Utils ‚Ä∫ requireAdmin ‚Ä∫ should return error when not admin

    TypeError: (0 , _utils.requireAdmin) is not a function

    [0m [90m 83 |[39m             (getServerSession [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockSession)[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAdmin()[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 86 |[39m
     [90m 87 |[39m             expect(result[33m.[39msession)[33m.[39mtoBeNull()[33m;[39m
     [90m 88 |[39m             expect(result[33m.[39merror)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:85:46)

  ‚óè API Utils ‚Ä∫ requireAdmin ‚Ä∫ should return session when admin

    TypeError: (0 , _utils.requireAdmin) is not a function

    [0m [90m  97 |[39m             (getServerSession [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockSession)[33m;[39m
     [90m  98 |[39m
    [31m[1m>[22m[39m[90m  99 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAdmin()[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 100 |[39m
     [90m 101 |[39m             expect(result[33m.[39msession)[33m.[39mtoEqual(mockSession)[33m;[39m
     [90m 102 |[39m             expect(result[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:99:46)

  ‚óè API Utils ‚Ä∫ errorResponse ‚Ä∫ should create 500 error by default

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"error": "„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏"},
      Object {
    -   "status": 500,
    +   "status": undefined,
      },

    Number of calls: 1

    [0m [90m 108 |[39m             errorResponse([32m'„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏'[39m)[33m;[39m
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 111 |[39m                 { error[33m:[39m [32m'„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏'[39m }[33m,[39m
     [90m 112 |[39m                 { status[33m:[39m [35m500[39m }
     [90m 113 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:110:39)

  ‚óè API Utils ‚Ä∫ validationErrorResponse ‚Ä∫ should create 400 response with message

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "details": undefined,
    -   "error": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "details": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "error": "Validation Error",
      },
      {"status": 400},

    Number of calls: 1

    [0m [90m 139 |[39m             validationErrorResponse([32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m)[33m;[39m
     [90m 140 |[39m
    [31m[1m>[22m[39m[90m 141 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 142 |[39m                 { error[33m:[39m [32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details[33m:[39m undefined }[33m,[39m
     [90m 143 |[39m                 { status[33m:[39m [35m400[39m }
     [90m 144 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:141:39)

  ‚óè API Utils ‚Ä∫ validationErrorResponse ‚Ä∫ should include details when provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -5,7 +5,7 @@
            "path": Array [
              "email",
            ],
          },
        ],
    -   "error": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "error": "Validation Error",
      },
      {"status": 400},

    Number of calls: 1

    [0m [90m 149 |[39m             validationErrorResponse([32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details)[33m;[39m
     [90m 150 |[39m
    [31m[1m>[22m[39m[90m 151 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 152 |[39m                 { error[33m:[39m [32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details }[33m,[39m
     [90m 153 |[39m                 { status[33m:[39m [35m400[39m }
     [90m 154 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:151:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should log error and return 500 for generic errors

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 170 |[39m             serverErrorResponse([32m'„Éá„Éº„ÇøÂèñÂæó'[39m[33m,[39m error)[33m;[39m
     [90m 171 |[39m
    [31m[1m>[22m[39m[90m 172 |[39m             expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 173 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m 174 |[39m                 { error[33m:[39m [32m'„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'[39m }[33m,[39m
     [90m 175 |[39m                 { status[33m:[39m [35m500[39m }[0m

      at Object.toHaveBeenCalled (__tests__/lib/api/utils.test.ts:172:35)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma unique constraint error (P2002)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2002", "error": StringContaining "Âêå„Åò„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô"},
    + {"details": [PrismaClientKnownRequestError: Unique constraint failed], "error": "„É¶„Éº„Ç∂„Éº‰ΩúÊàê"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 184 |[39m             serverErrorResponse([32m'„É¶„Éº„Ç∂„Éº‰ΩúÊàê'[39m[33m,[39m error)[33m;[39m
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 187 |[39m                 expect[33m.[39mobjectContaining({
     [90m 188 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'Âêå„Åò„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô'[39m)[33m,[39m
     [90m 189 |[39m                     code[33m:[39m [32m'P2002'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:186:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma foreign key error (P2003)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2003", "error": StringContaining "Èñ¢ÈÄ£„Åô„Çã„Éá„Éº„Çø„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ„Åã"},
    + {"details": [PrismaClientKnownRequestError: Foreign key constraint failed], "error": "ÈÖçÁΩÆ‰ΩúÊàê"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 200 |[39m             serverErrorResponse([32m'ÈÖçÁΩÆ‰ΩúÊàê'[39m[33m,[39m error)[33m;[39m
     [90m 201 |[39m
    [31m[1m>[22m[39m[90m 202 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 203 |[39m                 expect[33m.[39mobjectContaining({
     [90m 204 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'Èñ¢ÈÄ£„Åô„Çã„Éá„Éº„Çø„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ„Åã'[39m)[33m,[39m
     [90m 205 |[39m                     code[33m:[39m [32m'P2003'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:202:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma not found error (P2025)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2025", "error": StringContaining "ÂØæË±°„ÅÆ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"},
    + {"details": [PrismaClientKnownRequestError: Record not found], "error": "Ê°à‰ª∂ÂâäÈô§"},
      Object {
    -   "status": 404,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 216 |[39m             serverErrorResponse([32m'Ê°à‰ª∂ÂâäÈô§'[39m[33m,[39m error)[33m;[39m
     [90m 217 |[39m
    [31m[1m>[22m[39m[90m 218 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 219 |[39m                 expect[33m.[39mobjectContaining({
     [90m 220 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'ÂØæË±°„ÅÆ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'[39m)[33m,[39m
     [90m 221 |[39m                     code[33m:[39m [32m'P2025'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:218:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma validation error

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"error": StringContaining "ÂÖ•Âäõ„Éá„Éº„Çø„Åå‰∏çÊ≠£„Åß„Åô"},
    + {"details": [PrismaClientValidationError: Invalid input], "error": "„Éá„Éº„ÇøÊõ¥Êñ∞"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 232 |[39m             serverErrorResponse([32m'„Éá„Éº„ÇøÊõ¥Êñ∞'[39m[33m,[39m error)[33m;[39m
     [90m 233 |[39m
    [31m[1m>[22m[39m[90m 234 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 235 |[39m                 expect[33m.[39mobjectContaining({
     [90m 236 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'ÂÖ•Âäõ„Éá„Éº„Çø„Åå‰∏çÊ≠£„Åß„Åô'[39m)[33m,[39m
     [90m 237 |[39m                 })[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:234:39)

  ‚óè API Utils ‚Ä∫ successResponse ‚Ä∫ should return data without cache headers by default

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "1", "name": "Test"},
    - {"headers": {}},

    Number of calls: 1

    [0m [90m 245 |[39m             successResponse({ id[33m:[39m [32m'1'[39m[33m,[39m name[33m:[39m [32m'Test'[39m })[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 248 |[39m                 { id[33m:[39m [32m'1'[39m[33m,[39m name[33m:[39m [32m'Test'[39m }[33m,[39m
     [90m 249 |[39m                 { headers[33m:[39m {} }
     [90m 250 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:247:39)

  ‚óè API Utils ‚Ä∫ successResponse ‚Ä∫ should include cache headers when specified

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "1"},
    - ObjectContaining {"headers": ObjectContaining {"Cache-Control": StringContaining "max-age=300"}},

    Number of calls: 1

    [0m [90m 254 |[39m             successResponse({ id[33m:[39m [32m'1'[39m }[33m,[39m { cacheMaxAge[33m:[39m [35m300[39m })[33m;[39m
     [90m 255 |[39m
    [31m[1m>[22m[39m[90m 256 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 257 |[39m                 { id[33m:[39m [32m'1'[39m }[33m,[39m
     [90m 258 |[39m                 expect[33m.[39mobjectContaining({
     [90m 259 |[39m                     headers[33m:[39m expect[33m.[39mobjectContaining({[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:256:39)

  ‚óè API Utils ‚Ä∫ deleteSuccessResponse ‚Ä∫ should return success message with resource name

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Ê°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü",
    +   "message": "Ê°à‰ª∂",
      },

    Number of calls: 1

    [0m [90m 269 |[39m             deleteSuccessResponse([32m'Ê°à‰ª∂'[39m)[33m;[39m
     [90m 270 |[39m
    [31m[1m>[22m[39m[90m 271 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 272 |[39m                 message[33m:[39m [32m'Ê°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü'[39m[33m,[39m
     [90m 273 |[39m             })[33m;[39m
     [90m 274 |[39m         })[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:271:39)

  ‚óè API Utils ‚Ä∫ applyRateLimit ‚Ä∫ should return 429 response when rate limit exceeded

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"error": StringContaining "„É™„ÇØ„Ç®„Çπ„ÉàÊï∞„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü"}, ObjectContaining {"status": 429}

    Number of calls: 0

    [0m [90m 304 |[39m             applyRateLimit(mockReq)[33m;[39m
     [90m 305 |[39m
    [31m[1m>[22m[39m[90m 306 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 307 |[39m                 expect[33m.[39mobjectContaining({
     [90m 308 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'„É™„ÇØ„Ç®„Çπ„ÉàÊï∞„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü'[39m)[33m,[39m
     [90m 309 |[39m                 })[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:306:39)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ parseJsonField ‚Ä∫ should return default for invalid JSON

    SyntaxError: Unexpected token 'o', "not json" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 144 |[39m         [33mRATE_LIMITS[39m[33m:[39m { api[33m:[39m { limit[33m:[39m [35m100[39m[33m,[39m window[33m:[39m [35m60[39m } }[33m,[39m
     [90m 145 |[39m         stringifyJsonField[33m:[39m (val[33m:[39m any) [33m=>[39m [33mJSON[39m[33m.[39mstringify(val)[33m,[39m
    [31m[1m>[22m[39m[90m 146 |[39m         parseJsonField[33m:[39m (val[33m:[39m any[33m,[39m fallback[33m:[39m any) [33m=>[39m val [33m?[39m [33mJSON[39m[33m.[39mparse(val) [33m:[39m fallback[33m,[39m
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 147 |[39m         errorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m status) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m msg }[33m,[39m { status }))[33m,[39m
     [90m 148 |[39m         serverErrorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m error) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m msg[33m,[39m details[33m:[39m error }[33m,[39m { status[33m:[39m [35m500[39m }))[33m,[39m
     [90m 149 |[39m         validationErrorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m details) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m [32m'Validation Error'[39m[33m,[39m details[33m:[39m details [33m||[39m msg }[33m,[39m { status[33m:[39m [35m400[39m }))[33m,[39m[0m

      at parse (jest.setup.ts:146:65)
      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:328:46)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ stringifyJsonField ‚Ä∫ should return null for null input

    expect(received).toBeNull()

    Received: "null"

    [0m [90m 349 |[39m             it([32m'should return null for null input'[39m[33m,[39m () [33m=>[39m {
     [90m 350 |[39m                 [36mconst[39m result [33m=[39m stringifyJsonField([36mnull[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 351 |[39m                 expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 352 |[39m             })[33m;[39m
     [90m 353 |[39m
     [90m 354 |[39m             it([32m'should return null for undefined input'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:351:32)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ stringifyJsonField ‚Ä∫ should return null for undefined input

    expect(received).toBeNull()

    Received: undefined

    [0m [90m 354 |[39m             it([32m'should return null for undefined input'[39m[33m,[39m () [33m=>[39m {
     [90m 355 |[39m                 [36mconst[39m result [33m=[39m stringifyJsonField(undefined)[33m;[39m
    [31m[1m>[22m[39m[90m 356 |[39m                 expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 357 |[39m             })[33m;[39m
     [90m 358 |[39m         })[33m;[39m
     [90m 359 |[39m     })[33m;[39m[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:356:32)

FAIL __tests__/lib/formatters.test.ts
  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should format dates to ISO strings

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 31 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 32 |[39m
    [31m[1m>[22m[39m[90m 33 |[39m             expect(result[33m.[39mdate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 34 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 35 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m
     [90m 36 |[39m         })[33m;[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:33:33)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should parse JSON string fields to arrays

    expect(received).toEqual(expected) // deep equality

    Expected: ["worker1", "worker2"]
    Received: "[\"worker1\",\"worker2\"]"

    [0m [90m 50 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m             expect(result[33m.[39mworkers)[33m.[39mtoEqual([[32m'worker1'[39m[33m,[39m [32m'worker2'[39m])[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 53 |[39m             expect(result[33m.[39mvehicles)[33m.[39mtoEqual([[32m'vehicle1'[39m])[33m;[39m
     [90m 54 |[39m             expect(result[33m.[39mconfirmedWorkerIds)[33m.[39mtoEqual([[32m'confirmed1'[39m])[33m;[39m
     [90m 55 |[39m             expect(result[33m.[39mconfirmedVehicleIds)[33m.[39mtoEqual([[32m'vehicle2'[39m[33m,[39m [32m'vehicle3'[39m])[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:52:36)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should return empty arrays for null JSON fields

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 70 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m             expect(result[33m.[39mworkers)[33m.[39mtoEqual([])[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 73 |[39m             expect(result[33m.[39mvehicles)[33m.[39mtoEqual([])[33m;[39m
     [90m 74 |[39m             expect(result[33m.[39mconfirmedWorkerIds)[33m.[39mtoEqual([])[33m;[39m
     [90m 75 |[39m             expect(result[33m.[39mconfirmedVehicleIds)[33m.[39mtoEqual([])[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:72:36)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should format nested projectMaster if present

    expect(received).toEqual(expected) // deep equality

    Expected: ["user1", "user2"]
    Received: "[\"user1\",\"user2\"]"

    [0m [90m  98 |[39m
     [90m  99 |[39m             expect(result[33m.[39mprojectMaster)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 100 |[39m             expect(result[33m.[39mprojectMaster[33m?[39m[33m.[39mcreatedBy)[33m.[39mtoEqual([[32m'user1'[39m[33m,[39m [32m'user2'[39m])[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 101 |[39m             expect(result[33m.[39mprojectMaster[33m?[39m[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 102 |[39m         })[33m;[39m
     [90m 103 |[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:100:53)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should format dates to ISO strings

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 160 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 161 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 162 |[39m             expect(result[33m.[39massemblyDate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 163 |[39m             expect(result[33m.[39mdemolitionDate)[33m.[39mtoBe([32m'2024-02-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 164 |[39m         })[33m;[39m
     [90m 165 |[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:162:41)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should handle null dates

    expect(received).toBeNull()

    Received: undefined

    [0m [90m 178 |[39m
     [90m 179 |[39m             expect(result[33m.[39massemblyDate)[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 180 |[39m             expect(result[33m.[39mdemolitionDate)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 181 |[39m         })[33m;[39m
     [90m 182 |[39m
     [90m 183 |[39m         it([32m'should parse createdBy JSON string'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeNull (__tests__/lib/formatters.test.ts:180:43)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should parse createdBy JSON string

    expect(received).toEqual(expected) // deep equality

    Expected: ["manager1", "manager2"]
    Received: "[\"manager1\",\"manager2\"]"

    [0m [90m 192 |[39m             [36mconst[39m result [33m=[39m formatProjectMaster(raw)[33m;[39m
     [90m 193 |[39m
    [31m[1m>[22m[39m[90m 194 |[39m             expect(result[33m.[39mcreatedBy)[33m.[39mtoEqual([[32m'manager1'[39m[33m,[39m [32m'manager2'[39m])[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 195 |[39m         })[33m;[39m
     [90m 196 |[39m
     [90m 197 |[39m         it([32m'should format nested assignments'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:194:38)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should format nested assignments

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 219 |[39m
     [90m 220 |[39m             expect(result[33m.[39massignments)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m             expect(result[33m.[39massignments[33m?[39m[33m.[39m[[35m0[39m][33m.[39mdate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 222 |[39m             expect(result[33m.[39massignments[33m?[39m[33m.[39m[[35m0[39m][33m.[39mworkers)[33m.[39mtoEqual([[32m'w1'[39m])[33m;[39m
     [90m 223 |[39m         })[33m;[39m
     [90m 224 |[39m     })[33m;[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:221:50)

  ‚óè Formatters ‚Ä∫ formatEstimate ‚Ä∫ should format dates and parse items

    expect(received).toEqual(expected) // deep equality

    Expected: [{"amount": 1000, "description": "Item 1"}]
    Received: "[{\"description\":\"Item 1\",\"amount\":1000}]"

    [0m [90m 241 |[39m             [36mconst[39m result [33m=[39m formatEstimate(raw)[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([{ description[33m:[39m [32m'Item 1'[39m[33m,[39m amount[33m:[39m [35m1000[39m }])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 244 |[39m             expect(result[33m.[39mvalidUntil)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 245 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 246 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:243:34)

  ‚óè Formatters ‚Ä∫ formatEstimate ‚Ä∫ should return empty array for null items

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 258 |[39m             [36mconst[39m result [33m=[39m formatEstimate(raw)[33m;[39m
     [90m 259 |[39m
    [31m[1m>[22m[39m[90m 260 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 261 |[39m         })[33m;[39m
     [90m 262 |[39m
     [90m 263 |[39m         it([32m'should preserve numeric fields'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:260:34)

  ‚óè Formatters ‚Ä∫ formatInvoice ‚Ä∫ should format dates and parse items

    expect(received).toEqual(expected) // deep equality

    Expected: [{"amount": 2000, "description": "Service"}]
    Received: "[{\"description\":\"Service\",\"amount\":2000}]"

    [0m [90m 296 |[39m             [36mconst[39m result [33m=[39m formatInvoice(raw)[33m;[39m
     [90m 297 |[39m
    [31m[1m>[22m[39m[90m 298 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([{ description[33m:[39m [32m'Service'[39m[33m,[39m amount[33m:[39m [35m2000[39m }])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 299 |[39m             expect(result[33m.[39mdueDate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 300 |[39m             expect(result[33m.[39mpaidDate)[33m.[39mtoBe([32m'2024-01-20T10:00:00.000Z'[39m)[33m;[39m
     [90m 301 |[39m         })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:298:34)

  ‚óè Formatters ‚Ä∫ formatInvoice ‚Ä∫ should return empty array for null items

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 328 |[39m             [36mconst[39m result [33m=[39m formatInvoice(raw)[33m;[39m
     [90m 329 |[39m
    [31m[1m>[22m[39m[90m 330 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 331 |[39m         })[33m;[39m
     [90m 332 |[39m     })[33m;[39m
     [90m 333 |[39m })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:330:34)

PASS __tests__/components/Sidebar.test.tsx
PASS __tests__/components/Calendar/DraggableEventCard.test.tsx
PASS __tests__/components/Estimates/EstimateModal.test.tsx
PASS __tests__/api/assignments/route.test.ts
PASS __tests__/components/Calendar/CalendarHeader.test.tsx
PASS __tests__/hooks/useIsMobile.test.ts
PASS __tests__/components/ui/Button.test.tsx
PASS __tests__/hooks/useDebounce.test.ts
PASS __tests__/components/Header.test.tsx
PASS __tests__/api/users/route.test.ts
PASS __tests__/api/customers/route.test.ts
PASS __tests__/hooks/useDragAndDrop.test.ts
PASS __tests__/components/Customers/CustomerModal.test.tsx
PASS __tests__/api/daily-reports/route.test.ts
PASS __tests__/hooks/useProjects.test.ts
PASS __tests__/components/Projects/ProjectModal.test.tsx
PASS __tests__/api/project-masters/route.test.ts
PASS __tests__/components/Estimates/EstimateForm.test.tsx
PASS __tests__/components/ui/Loading.test.tsx
PASS __tests__/lib/validations/index.test.ts
PASS __tests__/stores/calendarStore.test.ts
  ‚óè Console

    console.error
      Fetch project masters error: Error: Ê°à‰ª∂„Éû„Çπ„Çø„Éº„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü
          at Object.fetchProjectMasters (C:\Users\yushink\Desktop\yusystem\stores\calendarStore.ts:191:27)
          at C:\Users\yushink\Desktop\yusystem\__tests__\stores\calendarStore.test.ts:41:17

    [0m [90m 198 |[39m                 })[33m;[39m
     [90m 199 |[39m             } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m 200 |[39m                 console[33m.[39merror([32m'Fetch project masters error:'[39m[33m,[39m err)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 201 |[39m                 [36mset[39m({ projectMastersError[33m:[39m err [36minstanceof[39m [33mError[39m [33m?[39m err[33m.[39mmessage [33m:[39m [32m'‰∏çÊòé„Å™„Ç®„É©„Éº'[39m })[33m;[39m
     [90m 202 |[39m             } [36mfinally[39m {
     [90m 203 |[39m                 [36mset[39m({ projectMastersLoading[33m:[39m [36mfalse[39m })[33m;[39m[0m

      at Object.error [as fetchProjectMasters] (stores/calendarStore.ts:200:25)
      at __tests__/stores/calendarStore.test.ts:41:17

PASS __tests__/utils/pdfGenerator.test.ts
  ‚óè Console

    console.log
      PDFÁîüÊàêÊàêÂäü: Ë¶ãÁ©çÊõ∏_EST-001_1769761369018.pdf

      at log (utils/pdfGenerator.ts:68:17)

    console.log
      PDFÁîüÊàêÊàêÂäü: Ë¶ãÁ©çÊõ∏_EST-001_1769761369063.pdf

      at log (utils/pdfGenerator.ts:68:17)

PASS __tests__/api/project-masters/id.route.test.ts
PASS __tests__/hooks/useCalendar.test.ts
PASS __tests__/components/Calendar/EventCard.test.tsx
PASS __tests__/hooks/useLocalStorage.test.ts
PASS __tests__/stores/masterStore.test.ts
PASS __tests__/stores/financeStore.test.ts
PASS __tests__/api/estimates/route.test.ts
PASS __tests__/utils/costCalculation.test.ts
PASS __tests__/components/Invoices/InvoiceModal.test.tsx
PASS __tests__/utils/employeeUtils.test.ts
PASS __tests__/utils/dateUtils.test.ts
PASS __tests__/utils/estimateCalculations.test.ts
PASS __tests__/api/invoices/route.test.ts
PASS __tests__/lib/api-utils.test.ts
PASS __tests__/components/Projects/ProjectForm.test.tsx
PASS __tests__/components/Customers/CustomerForm.test.tsx
----------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------
File                                          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                               
----------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------
All files                                     |      19 |    17.58 |   13.28 |   19.81 |                                                                                                 
 app                                          |       0 |      100 |       0 |       0 |                                                                                                 
  layout.tsx                                  |       0 |      100 |       0 |       0 | 2-18                                                                                            
 app/(calendar)                               |       0 |        0 |       0 |       0 |                                                                                                 
  layout.tsx                                  |       0 |      100 |       0 |       0 | 1-3                                                                                             
  page.tsx                                    |       0 |        0 |       0 |       0 | 1-12                                                                                            
 app/(calendar)/daily-reports                 |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-371                                                                                           
 app/(finance)                                |       0 |      100 |       0 |       0 |                                                                                                 
  layout.tsx                                  |       0 |      100 |       0 |       0 | 1-3                                                                                             
 app/(finance)/estimates                      |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-414                                                                                           
 app/(finance)/estimates/[id]                 |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-185                                                                                           
 app/(finance)/invoices                       |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-406                                                                                           
 app/(master)                                 |       0 |      100 |       0 |       0 |                                                                                                 
  layout.tsx                                  |       0 |      100 |       0 |       0 | 1-3                                                                                             
 app/(master)/customers                       |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-180                                                                                           
 app/(master)/project-masters                 |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-421                                                                                           
 app/(master)/projects                        |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-322                                                                                           
 app/(master)/settings                        |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-322                                                                                           
 app/(standalone)/login                       |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-108                                                                                           
 app/(standalone)/profit-dashboard            |       0 |        0 |       0 |       0 |                                                                                                 
  loading.tsx                                 |       0 |      100 |       0 |       0 | 1-60                                                                                            
  page.tsx                                    |       0 |        0 |       0 |       0 | 1-32                                                                                            
 app/(standalone)/profit-dashboard/components |       0 |        0 |       0 |       0 |                                                                                                 
  ProfitDashboardClient.tsx                   |       0 |        0 |       0 |       0 | 3-282                                                                                           
  ProfitDashboardWrapper.tsx                  |       0 |        0 |       0 |       0 | 3-24                                                                                            
 app/api/assignments                          |    87.5 |     67.5 |     100 |   95.65 |                                                                                                 
  route.ts                                    |    87.5 |     67.5 |     100 |   95.65 | 47,101                                                                                          
 app/api/assignments/[id]                     |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-100                                                                                           
 app/api/assignments/batch                    |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-65                                                                                            
 app/api/auth/[...nextauth]                   |       0 |      100 |     100 |       0 |                                                                                                 
  route.ts                                    |       0 |      100 |     100 |       0 | 1-6                                                                                             
 app/api/calendar/remarks                     |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-35                                                                                            
 app/api/calendar/vacations                   |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-43                                                                                            
 app/api/customers                            |   91.42 |     90.9 |     100 |   93.93 |                                                                                                 
  route.ts                                    |   91.42 |     90.9 |     100 |   93.93 | 66,104                                                                                          
 app/api/customers/[id]                       |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-97                                                                                            
 app/api/daily-reports                        |   81.63 |    76.66 |     100 |   84.44 |                                                                                                 
  route.ts                                    |   81.63 |    76.66 |     100 |   84.44 | 31-35,43,83                                                                                     
 app/api/daily-reports/[id]                   |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-34                                                                                            
 app/api/dispatch/foremen                     |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-23                                                                                            
 app/api/dispatch/workers                     |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-23                                                                                            
 app/api/estimates                            |    87.5 |    71.42 |     100 |   93.33 |                                                                                                 
  route.ts                                    |    87.5 |    71.42 |     100 |   93.33 | 31,57                                                                                           
 app/api/estimates/[id]                       |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-51                                                                                            
 app/api/init-db                              |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-25                                                                                            
 app/api/invoices                             |    87.5 |    74.19 |     100 |   93.33 |                                                                                                 
  route.ts                                    |    87.5 |    74.19 |     100 |   93.33 | 31,58                                                                                           
 app/api/invoices/[id]                        |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-53                                                                                            
 app/api/master-data                          |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-22                                                                                            
 app/api/master-data/company                  |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-39                                                                                            
 app/api/master-data/managers                 |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-28                                                                                            
 app/api/master-data/managers/[id]            |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-32                                                                                            
 app/api/master-data/settings                 |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-33                                                                                            
 app/api/master-data/unit-prices              |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-37                                                                                            
 app/api/master-data/unit-prices/[id]         |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-42                                                                                            
 app/api/master-data/vehicles                 |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-28                                                                                            
 app/api/master-data/vehicles/[id]            |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-32                                                                                            
 app/api/master-data/workers                  |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-28                                                                                            
 app/api/master-data/workers/[id]             |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-32                                                                                            
 app/api/profit-dashboard                     |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-134                                                                                           
 app/api/project-masters                      |   90.38 |    88.33 |     100 |   95.65 |                                                                                                 
  route.ts                                    |   90.38 |    88.33 |     100 |   95.65 | 56,100                                                                                          
 app/api/project-masters/[id]                 |   69.04 |    53.33 |     100 |   94.64 |                                                                                                 
  route.ts                                    |   69.04 |    53.33 |     100 |   94.64 | 22,62,76                                                                                        
 app/api/project-masters/[id]/history         |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-53                                                                                            
 app/api/project-masters/[id]/profit          |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-74                                                                                            
 app/api/user-settings                        |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-31                                                                                            
 app/api/users                                |   82.22 |    66.66 |     100 |   94.44 |                                                                                                 
  route.ts                                    |   82.22 |    66.66 |     100 |   94.44 | 31,80                                                                                           
 app/api/users/[id]                           |       0 |        0 |       0 |       0 |                                                                                                 
  route.ts                                    |       0 |        0 |       0 |       0 | 1-76                                                                                            
 app/dev/pdf-preview                          |       0 |        0 |       0 |       0 |                                                                                                 
  page.tsx                                    |       0 |        0 |       0 |       0 | 3-235                                                                                           
 app/providers                                |       0 |      100 |       0 |       0 |                                                                                                 
  CalendarProviders.tsx                       |       0 |      100 |       0 |       0 | 9                                                                                               
  FinanceProviders.tsx                        |       0 |      100 |       0 |       0 | 8                                                                                               
  MasterProviders.tsx                         |       0 |      100 |       0 |       0 | 7                                                                                               
 components                                   |   23.16 |    15.04 |      22 |   23.95 |                                                                                                 
  AuthProvider.tsx                            |       0 |      100 |       0 |       0 | 3-5                                                                                             
  Header.tsx                                  |     100 |      100 |     100 |     100 |                                                                                                 
  MainContent.tsx                             |       0 |        0 |       0 |       0 | 3-99                                                                                            
  ProjectMasterSearchModal.tsx                |       0 |        0 |       0 |       0 | 3-185                                                                                           
  ProjectSearchModal.tsx                      |       0 |        0 |       0 |       0 | 3-165                                                                                           
  Sidebar.tsx                                 |   60.46 |    48.48 |   81.81 |      65 | 69-70,84-90,99-105,171-174                                                                      
  VehicleModal.tsx                            |   52.63 |       25 |      25 |      50 | 17-25,29-30,66                                                                                  
 components/Calendar                          |    4.11 |    11.29 |    4.19 |     4.4 |                                                                                                 
  CalendarHeader.tsx                          |     100 |      100 |     100 |     100 |                                                                                                 
  CopyAssignmentModal.tsx                     |       0 |        0 |       0 |       0 | 3-167                                                                                           
  DayColumn.tsx                               |       0 |        0 |       0 |       0 | 1-53                                                                                            
  DispatchConfirmModal.tsx                    |       0 |        0 |       0 |       0 | 3-249                                                                                           
  DraggableEventCard.tsx                      |      70 |    90.62 |      50 |      70 | 94,136,153-154,184-185                                                                          
  DroppableCell.tsx                           |       0 |        0 |       0 |       0 | 1-37                                                                                            
  EmployeeRowComponent.tsx                    |       0 |        0 |       0 |       0 | 1-147                                                                                           
  EventCard.tsx                               |     100 |    42.85 |     100 |     100 | 119-127                                                                                         
  ForemanSelector.tsx                         |       0 |        0 |       0 |       0 | 1-58                                                                                            
  MobileDayView.tsx                           |       0 |        0 |       0 |       0 | 3-141                                                                                           
  ProjectSelectionModal.tsx                   |       0 |        0 |       0 |       0 | 3-18                                                                                            
  RemarksRow.tsx                              |       0 |        0 |       0 |       0 | 1-94                                                                                            
  VacationSelector.tsx                        |       0 |        0 |       0 |       0 | 1-95                                                                                            
  WeeklyCalendar.tsx                          |       0 |        0 |       0 |       0 | 3-311                                                                                           
 components/Customers                         |   84.21 |       92 |      80 |   83.78 |                                                                                                 
  CustomerForm.tsx                            |   81.25 |     90.9 |   78.94 |   81.25 | 62-63,147-154,200,243                                                                           
  CustomerModal.tsx                           |     100 |      100 |     100 |     100 |                                                                                                 
 components/DailyReport                       |       0 |        0 |       0 |       0 |                                                                                                 
  DailyReportForm.tsx                         |       0 |        0 |       0 |       0 | 3-293                                                                                           
  DailyReportModal.tsx                        |       0 |        0 |       0 |       0 | 3-401                                                                                           
 components/Estimates                         |    27.5 |    21.32 |   17.07 |   28.57 |                                                                                                 
  EstimateDetailModal.tsx                     |       0 |        0 |       0 |       0 | 3-195                                                                                           
  EstimateForm.tsx                            |   36.94 |    29.76 |   21.42 |   39.04 | 43-47,65,78-121,158-176,181-182,188-197,203-206,211-214,219-252,274-285,307-339,351-408,447-615 
  EstimateModal.tsx                           |     100 |      100 |     100 |     100 |                                                                                                 
  UnitPriceMasterModal.tsx                    |       0 |        0 |       0 |       0 | 3-107                                                                                           
 components/Invoices                          |    9.52 |     7.54 |    6.89 |    8.75 |                                                                                                 
  InvoiceForm.tsx                             |       0 |        0 |       0 |       0 | 3-339                                                                                           
  InvoiceModal.tsx                            |     100 |      100 |     100 |     100 |                                                                                                 
 components/ProjectMaster                     |       0 |        0 |       0 |       0 |                                                                                                 
  ProjectProfitDisplay.tsx                    |       0 |        0 |       0 |       0 | 3-177                                                                                           
  WorkHistoryDisplay.tsx                      |       0 |        0 |       0 |       0 | 3-98                                                                                            
 components/ProjectMasters                    |       0 |        0 |       0 |       0 |                                                                                                 
  ProjectMasterForm.tsx                       |       0 |        0 |       0 |       0 | 3-127                                                                                           
 components/ProjectMasters/common             |       0 |        0 |       0 |       0 |                                                                                                 
  CollapsibleSection.tsx                      |       0 |        0 |       0 |       0 | 3-13                                                                                            
  FormField.tsx                               |       0 |        0 |       0 |       0 | 3-11                                                                                            
 components/ProjectMasters/sections           |       0 |        0 |       0 |       0 |                                                                                                 
  AddressSection.tsx                          |       0 |        0 |       0 |       0 | 3-105                                                                                           
  BasicInfoSection.tsx                        |       0 |        0 |       0 |       0 | 3-176                                                                                           
  ConstructionSection.tsx                     |       0 |      100 |       0 |       0 | 3-94                                                                                            
  RemarksSection.tsx                          |       0 |      100 |       0 |       0 | 3-15                                                                                            
  ScaffoldingSection.tsx                      |       0 |        0 |       0 |       0 | 3-279                                                                                           
 components/Projects                          |   46.32 |    43.62 |   28.39 |   46.01 |                                                                                                 
  MultiDayScheduleEditor.tsx                  |    6.06 |        0 |       0 |    6.15 | 15-330                                                                                          
  ProjectDetailView.tsx                       |       0 |        0 |       0 |       0 | 3-130                                                                                           
  ProjectForm.tsx                             |   64.16 |    53.21 |   35.55 |    64.1 | 97,106-108,123,128,143-144,149,160,166-169,185,212-221,287-311,358-367,402-562,584,614-660      
  ProjectModal.tsx                            |   92.85 |    84.61 |    87.5 |   92.59 | 116-117                                                                                         
 components/Schedule                          |       0 |        0 |       0 |       0 |                                                                                                 
  AssignmentTable.tsx                         |       0 |        0 |       0 |       0 | 3-329                                                                                           
  ScheduleViewTabs.tsx                        |       0 |        0 |       0 |       0 | 3-35                                                                                            
 components/Settings                          |       0 |        0 |       0 |       0 |                                                                                                 
  CompanyInfoSettings.tsx                     |       0 |        0 |       0 |       0 | 3-286                                                                                           
  UnitPriceMasterSettings.tsx                 |       0 |        0 |       0 |       0 | 3-244                                                                                           
  UserManagement.tsx                          |       0 |        0 |       0 |       0 | 3-249                                                                                           
  UserModal.tsx                               |       0 |        0 |       0 |       0 | 3-200                                                                                           
 components/pdf                               |       0 |        0 |       0 |       0 |                                                                                                 
  EstimatePDF.tsx                             |       0 |        0 |       0 |       0 | 3-655                                                                                           
  InvoicePDF.tsx                              |       0 |        0 |       0 |       0 | 3-551                                                                                           
  styles.ts                                   |       0 |      100 |       0 |       0 | 1-114                                                                                           
 components/ui                                |   96.42 |      100 |     100 |     100 |                                                                                                 
  Button.tsx                                  |   93.75 |      100 |     100 |     100 |                                                                                                 
  Loading.tsx                                 |     100 |      100 |     100 |     100 |                                                                                                 
 contexts                                     |       0 |        0 |       0 |       0 |                                                                                                 
  AssignmentContext.tsx                       |       0 |        0 |       0 |       0 | 3-290                                                                                           
  NavigationContext.tsx                       |       0 |        0 |       0 |       0 | 3-53                                                                                            
  ProfitDashboardContext.tsx                  |       0 |        0 |       0 |       0 | 3-118                                                                                           
 hooks                                        |   24.19 |    21.16 |   21.73 |   25.86 |                                                                                                 
  useCalendar.ts                              |     100 |    66.66 |     100 |     100 | 25                                                                                              
  useCalendarDisplay.ts                       |       0 |        0 |       0 |       0 | 3-55                                                                                            
  useCalendarModals.ts                        |       0 |        0 |       0 |       0 | 1-175                                                                                           
  useCompany.ts                               |       0 |        0 |       0 |       0 | 3-77                                                                                            
  useCustomerSearch.ts                        |       0 |        0 |       0 |       0 | 1-35                                                                                            
  useCustomers.ts                             |       0 |        0 |       0 |       0 | 3-63                                                                                            
  useDailyReports.ts                          |       0 |        0 |       0 |       0 | 3-66                                                                                            
  useDebounce.ts                              |     100 |      100 |     100 |     100 |                                                                                                 
  useDragAndDrop.ts                           |   92.72 |       70 |     100 |   91.83 | 55,63,97,105                                                                                    
  useEstimates.ts                             |       0 |        0 |       0 |       0 | 3-64                                                                                            
  useInvoices.ts                              |       0 |        0 |       0 |       0 | 3-84                                                                                            
  useIsMobile.ts                              |   94.44 |    66.66 |     100 |     100 | 13                                                                                              
  useLocalStorage.ts                          |    91.3 |    83.33 |     100 |    91.3 | 10,32                                                                                           
  useMasterData.ts                            |       0 |        0 |       0 |       0 | 3-55                                                                                            
  usePostalCodeAutofill.ts                    |       0 |        0 |       0 |       0 | 1-34                                                                                            
  useProjectMasters.ts                        |       0 |        0 |       0 |       0 | 3-73                                                                                            
  useProjects.ts                              |   79.34 |    54.54 |   67.74 |   79.22 | 50,72-88,97-98,122-126,135,139,143-144                                                          
  useRealtimeSubscription.ts                  |       0 |        0 |       0 |       0 | 1-175                                                                                           
  useRemarks.ts                               |       0 |        0 |       0 |       0 | 3-51                                                                                            
  useUnitPriceMaster.ts                       |       0 |        0 |       0 |       0 | 3-64                                                                                            
  useVacation.ts                              |       0 |        0 |       0 |       0 | 3-76                                                                                            
 utils                                        |   60.85 |    32.59 |   48.88 |   61.86 |                                                                                                 
  costCalculation.ts                          |     100 |      100 |     100 |     100 |                                                                                                 
  dateUtils.ts                                |   88.67 |    83.33 |      80 |   88.23 | 52,123-133,154                                                                                  
  employeeUtils.ts                            |   32.14 |    16.66 |      30 |   33.33 | 8-45,61-66                                                                                      
  pdfGenerator.ts                             |   83.01 |    36.95 |   66.66 |   82.91 | 70-115,344-354                                                                                  
  permissions.ts                              |       0 |        0 |       0 |       0 | 11-150                                                                                          
  reactPdfGenerator.tsx                       |       0 |        0 |       0 |       0 | 3-128                                                                                           
 utils/fonts                                  |      20 |      100 |       0 |   11.11 |                                                                                                 
  NotoSansJP-font.ts                          |     100 |      100 |     100 |     100 |                                                                                                 
  japanese.ts                                 |       0 |      100 |       0 |       0 | 16-46                                                                                           
----------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL __tests__/utils/permissions.test.ts
  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for null/undefined user

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 12 |[39m     describe([32m'hasPermission'[39m[33m,[39m () [33m=>[39m {
     [90m 13 |[39m         it([32m'returns false for null/undefined user'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 14 |[39m             expect(hasPermission([36mnull[39m[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                             [31m[1m^[22m[39m
     [90m 15 |[39m             expect(hasPermission(undefined[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 16 |[39m         })[33m;[39m
     [90m 17 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:14:61)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for inactive user

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 17 |[39m
     [90m 18 |[39m         it([32m'returns false for inactive user'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 19 |[39m             expect(hasPermission({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mfalse[39m }[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                           [31m[1m^[22m[39m
     [90m 20 |[39m         })[33m;[39m
     [90m 21 |[39m
     [90m 22 |[39m         it([32m'admin has full permissions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:19:91)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ worker has limited permissions

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 30 |[39m             [36mconst[39m worker [33m=[39m { role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m;[39m
     [90m 31 |[39m             expect(hasPermission(worker[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 32 |[39m             expect(hasPermission(worker[33m,[39m [32m'projects'[39m[33m,[39m [32m'edit'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                               [31m[1m^[22m[39m
     [90m 33 |[39m             expect(hasPermission(worker[33m,[39m [32m'estimates'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 34 |[39m         })[33m;[39m
     [90m 35 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:32:63)

  ‚óè permissions ‚Ä∫ hasPermission ‚Ä∫ returns false for unknown role

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 35 |[39m
     [90m 36 |[39m         it([32m'returns false for unknown role'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 37 |[39m             expect(hasPermission({ role[33m:[39m [32m'unknown'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m,[39m [32m'projects'[39m[33m,[39m [32m'view'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                            [31m[1m^[22m[39m
     [90m 38 |[39m         })[33m;[39m
     [90m 39 |[39m     })[33m;[39m
     [90m 40 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:37:92)

  ‚óè permissions ‚Ä∫ canAccessProject ‚Ä∫ worker needs assigned projects

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 49 |[39m             [36mconst[39m worker [33m=[39m { role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m[33m,[39m assignedProjects[33m:[39m [[32m'proj-1'[39m[33m,[39m [32m'proj-2'[39m] }[33m;[39m
     [90m 50 |[39m             expect(canAccessProject(worker[33m,[39m [32m'proj-1'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 51 |[39m             expect(canAccessProject(worker[33m,[39m [32m'proj-3'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 52 |[39m         })[33m;[39m
     [90m 53 |[39m
     [90m 54 |[39m         it([32m'worker without assignedProjects returns false'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:51:56)

  ‚óè permissions ‚Ä∫ canAccessProject ‚Ä∫ worker without assignedProjects returns false

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 53 |[39m
     [90m 54 |[39m         it([32m'worker without assignedProjects returns false'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 55 |[39m             expect(canAccessProject({ role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }[33m,[39m [32m'proj-1'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                                    [31m[1m^[22m[39m
     [90m 56 |[39m         })[33m;[39m
     [90m 57 |[39m     })[33m;[39m
     [90m 58 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:55:84)

  ‚óè permissions ‚Ä∫ canDispatch ‚Ä∫ foreman2/worker cannot dispatch

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 65 |[39m
     [90m 66 |[39m         it([32m'foreman2/worker cannot dispatch'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 67 |[39m             expect(canDispatch({ role[33m:[39m [32m'foreman2'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                       [31m[1m^[22m[39m
     [90m 68 |[39m             expect(canDispatch({ role[33m:[39m [32m'worker'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 69 |[39m         })[33m;[39m
     [90m 70 |[39m     })[33m;[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:67:71)

  ‚óè permissions ‚Ä∫ isManagerOrAbove ‚Ä∫ only admin and manager return true

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 74 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 75 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'manager'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m             expect(isManagerOrAbove({ role[33m:[39m [32m'foreman1'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                            [31m[1m^[22m[39m
     [90m 77 |[39m         })[33m;[39m
     [90m 78 |[39m     })[33m;[39m
     [90m 79 |[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:76:76)

  ‚óè permissions ‚Ä∫ isAdmin / canManageUsers ‚Ä∫ only active admin returns true

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 81 |[39m         it([32m'only active admin returns true'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m             expect(isAdmin({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 83 |[39m             expect(isAdmin({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mfalse[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                                 [31m[1m^[22m[39m
     [90m 84 |[39m             expect(isAdmin({ role[33m:[39m [32m'manager'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 85 |[39m             expect(canManageUsers({ role[33m:[39m [32m'admin'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m }))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 86 |[39m         })[33m;[39m[0m

      at Object.toBe (__tests__/utils/permissions.test.ts:83:65)

  ‚óè permissions ‚Ä∫ getRoleDisplayName ‚Ä∫ returns Japanese role names

    TypeError: (0 , _permissions.getRoleDisplayName) is not a function

    [0m [90m 89 |[39m     describe([32m'getRoleDisplayName'[39m[33m,[39m () [33m=>[39m {
     [90m 90 |[39m         it([32m'returns Japanese role names'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 91 |[39m             expect(getRoleDisplayName([32m'admin'[39m))[33m.[39mtoBe([32m'ÁÆ°ÁêÜËÄÖ'[39m)[33m;[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 92 |[39m             expect(getRoleDisplayName([32m'manager'[39m))[33m.[39mtoBe([32m'„Éû„Éç„Éº„Ç∏„É£„Éº'[39m)[33m;[39m
     [90m 93 |[39m             expect(getRoleDisplayName([32m'foreman1'[39m))[33m.[39mtoBe([32m'ËÅ∑Èï∑1'[39m)[33m;[39m
     [90m 94 |[39m             expect(getRoleDisplayName([32m'foreman2'[39m))[33m.[39mtoBe([32m'ËÅ∑Èï∑2'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/utils/permissions.test.ts:91:38)

FAIL __tests__/lib/api/utils.test.ts
  ‚óè API Utils ‚Ä∫ requireAuth ‚Ä∫ should return error when no session

    expect(received).toBeNull()

    Received: {"user": {"id": "user-1", "isActive": true, "role": "manager"}}

    [0m [90m 59 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAuth()[33m;[39m
     [90m 60 |[39m
    [31m[1m>[22m[39m[90m 61 |[39m             expect(result[33m.[39msession)[33m.[39mtoBeNull()[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 62 |[39m             expect(result[33m.[39merror)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m
     [90m 63 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m 64 |[39m                 { error[33m:[39m [32m'Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô'[39m }[33m,[39m[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:61:36)

  ‚óè API Utils ‚Ä∫ requireAuth ‚Ä∫ should return session when authenticated

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 2

      Object {
        "user": Object {
          "id": "user-1",
    -     "role": "admin",
    +     "isActive": true,
    +     "role": "manager",
        },
      }

    [0m [90m 73 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAuth()[33m;[39m
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m             expect(result[33m.[39msession)[33m.[39mtoEqual(mockSession)[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 76 |[39m             expect(result[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m
     [90m 77 |[39m         })[33m;[39m
     [90m 78 |[39m     })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/api/utils.test.ts:75:36)

  ‚óè API Utils ‚Ä∫ requireAdmin ‚Ä∫ should return error when not admin

    TypeError: (0 , _utils.requireAdmin) is not a function

    [0m [90m 83 |[39m             (getServerSession [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockSession)[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAdmin()[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 86 |[39m
     [90m 87 |[39m             expect(result[33m.[39msession)[33m.[39mtoBeNull()[33m;[39m
     [90m 88 |[39m             expect(result[33m.[39merror)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:85:46)

  ‚óè API Utils ‚Ä∫ requireAdmin ‚Ä∫ should return session when admin

    TypeError: (0 , _utils.requireAdmin) is not a function

    [0m [90m  97 |[39m             (getServerSession [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue(mockSession)[33m;[39m
     [90m  98 |[39m
    [31m[1m>[22m[39m[90m  99 |[39m             [36mconst[39m result [33m=[39m [36mawait[39m requireAdmin()[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 100 |[39m
     [90m 101 |[39m             expect(result[33m.[39msession)[33m.[39mtoEqual(mockSession)[33m;[39m
     [90m 102 |[39m             expect(result[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:99:46)

  ‚óè API Utils ‚Ä∫ errorResponse ‚Ä∫ should create 500 error by default

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"error": "„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏"},
      Object {
    -   "status": 500,
    +   "status": undefined,
      },

    Number of calls: 1

    [0m [90m 108 |[39m             errorResponse([32m'„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏'[39m)[33m;[39m
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 111 |[39m                 { error[33m:[39m [32m'„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏'[39m }[33m,[39m
     [90m 112 |[39m                 { status[33m:[39m [35m500[39m }
     [90m 113 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:110:39)

  ‚óè API Utils ‚Ä∫ validationErrorResponse ‚Ä∫ should create 400 response with message

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "details": undefined,
    -   "error": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "details": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "error": "Validation Error",
      },
      {"status": 400},

    Number of calls: 1

    [0m [90m 139 |[39m             validationErrorResponse([32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m)[33m;[39m
     [90m 140 |[39m
    [31m[1m>[22m[39m[90m 141 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 142 |[39m                 { error[33m:[39m [32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details[33m:[39m undefined }[33m,[39m
     [90m 143 |[39m                 { status[33m:[39m [35m400[39m }
     [90m 144 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:141:39)

  ‚óè API Utils ‚Ä∫ validationErrorResponse ‚Ä∫ should include details when provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -5,7 +5,7 @@
            "path": Array [
              "email",
            ],
          },
        ],
    -   "error": "ÂÖ•Âäõ„Ç®„É©„Éº",
    +   "error": "Validation Error",
      },
      {"status": 400},

    Number of calls: 1

    [0m [90m 149 |[39m             validationErrorResponse([32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details)[33m;[39m
     [90m 150 |[39m
    [31m[1m>[22m[39m[90m 151 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 152 |[39m                 { error[33m:[39m [32m'ÂÖ•Âäõ„Ç®„É©„Éº'[39m[33m,[39m details }[33m,[39m
     [90m 153 |[39m                 { status[33m:[39m [35m400[39m }
     [90m 154 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:151:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should log error and return 500 for generic errors

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 170 |[39m             serverErrorResponse([32m'„Éá„Éº„ÇøÂèñÂæó'[39m[33m,[39m error)[33m;[39m
     [90m 171 |[39m
    [31m[1m>[22m[39m[90m 172 |[39m             expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 173 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m 174 |[39m                 { error[33m:[39m [32m'„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'[39m }[33m,[39m
     [90m 175 |[39m                 { status[33m:[39m [35m500[39m }[0m

      at Object.toHaveBeenCalled (__tests__/lib/api/utils.test.ts:172:35)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma unique constraint error (P2002)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2002", "error": StringContaining "Âêå„Åò„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô"},
    + {"details": [PrismaClientKnownRequestError: Unique constraint failed], "error": "„É¶„Éº„Ç∂„Éº‰ΩúÊàê"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 184 |[39m             serverErrorResponse([32m'„É¶„Éº„Ç∂„Éº‰ΩúÊàê'[39m[33m,[39m error)[33m;[39m
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 187 |[39m                 expect[33m.[39mobjectContaining({
     [90m 188 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'Âêå„Åò„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô'[39m)[33m,[39m
     [90m 189 |[39m                     code[33m:[39m [32m'P2002'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:186:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma foreign key error (P2003)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2003", "error": StringContaining "Èñ¢ÈÄ£„Åô„Çã„Éá„Éº„Çø„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ„Åã"},
    + {"details": [PrismaClientKnownRequestError: Foreign key constraint failed], "error": "ÈÖçÁΩÆ‰ΩúÊàê"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 200 |[39m             serverErrorResponse([32m'ÈÖçÁΩÆ‰ΩúÊàê'[39m[33m,[39m error)[33m;[39m
     [90m 201 |[39m
    [31m[1m>[22m[39m[90m 202 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 203 |[39m                 expect[33m.[39mobjectContaining({
     [90m 204 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'Èñ¢ÈÄ£„Åô„Çã„Éá„Éº„Çø„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ„Åã'[39m)[33m,[39m
     [90m 205 |[39m                     code[33m:[39m [32m'P2003'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:202:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma not found error (P2025)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"code": "P2025", "error": StringContaining "ÂØæË±°„ÅÆ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"},
    + {"details": [PrismaClientKnownRequestError: Record not found], "error": "Ê°à‰ª∂ÂâäÈô§"},
      Object {
    -   "status": 404,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 216 |[39m             serverErrorResponse([32m'Ê°à‰ª∂ÂâäÈô§'[39m[33m,[39m error)[33m;[39m
     [90m 217 |[39m
    [31m[1m>[22m[39m[90m 218 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 219 |[39m                 expect[33m.[39mobjectContaining({
     [90m 220 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'ÂØæË±°„ÅÆ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'[39m)[33m,[39m
     [90m 221 |[39m                     code[33m:[39m [32m'P2025'[39m[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:218:39)

  ‚óè API Utils ‚Ä∫ serverErrorResponse ‚Ä∫ should handle Prisma validation error

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    - ObjectContaining {"error": StringContaining "ÂÖ•Âäõ„Éá„Éº„Çø„Åå‰∏çÊ≠£„Åß„Åô"},
    + {"details": [PrismaClientValidationError: Invalid input], "error": "„Éá„Éº„ÇøÊõ¥Êñ∞"},
      Object {
    -   "status": 400,
    +   "status": 500,
      },

    Number of calls: 1

    [0m [90m 232 |[39m             serverErrorResponse([32m'„Éá„Éº„ÇøÊõ¥Êñ∞'[39m[33m,[39m error)[33m;[39m
     [90m 233 |[39m
    [31m[1m>[22m[39m[90m 234 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 235 |[39m                 expect[33m.[39mobjectContaining({
     [90m 236 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'ÂÖ•Âäõ„Éá„Éº„Çø„Åå‰∏çÊ≠£„Åß„Åô'[39m)[33m,[39m
     [90m 237 |[39m                 })[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:234:39)

  ‚óè API Utils ‚Ä∫ successResponse ‚Ä∫ should return data without cache headers by default

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "1", "name": "Test"},
    - {"headers": {}},

    Number of calls: 1

    [0m [90m 245 |[39m             successResponse({ id[33m:[39m [32m'1'[39m[33m,[39m name[33m:[39m [32m'Test'[39m })[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 248 |[39m                 { id[33m:[39m [32m'1'[39m[33m,[39m name[33m:[39m [32m'Test'[39m }[33m,[39m
     [90m 249 |[39m                 { headers[33m:[39m {} }
     [90m 250 |[39m             )[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:247:39)

  ‚óè API Utils ‚Ä∫ successResponse ‚Ä∫ should include cache headers when specified

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "1"},
    - ObjectContaining {"headers": ObjectContaining {"Cache-Control": StringContaining "max-age=300"}},

    Number of calls: 1

    [0m [90m 254 |[39m             successResponse({ id[33m:[39m [32m'1'[39m }[33m,[39m { cacheMaxAge[33m:[39m [35m300[39m })[33m;[39m
     [90m 255 |[39m
    [31m[1m>[22m[39m[90m 256 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 257 |[39m                 { id[33m:[39m [32m'1'[39m }[33m,[39m
     [90m 258 |[39m                 expect[33m.[39mobjectContaining({
     [90m 259 |[39m                     headers[33m:[39m expect[33m.[39mobjectContaining({[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:256:39)

  ‚óè API Utils ‚Ä∫ deleteSuccessResponse ‚Ä∫ should return success message with resource name

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Ê°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü",
    +   "message": "Ê°à‰ª∂",
      },

    Number of calls: 1

    [0m [90m 269 |[39m             deleteSuccessResponse([32m'Ê°à‰ª∂'[39m)[33m;[39m
     [90m 270 |[39m
    [31m[1m>[22m[39m[90m 271 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 272 |[39m                 message[33m:[39m [32m'Ê°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü'[39m[33m,[39m
     [90m 273 |[39m             })[33m;[39m
     [90m 274 |[39m         })[33m;[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:271:39)

  ‚óè API Utils ‚Ä∫ applyRateLimit ‚Ä∫ should return 429 response when rate limit exceeded

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"error": StringContaining "„É™„ÇØ„Ç®„Çπ„ÉàÊï∞„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü"}, ObjectContaining {"status": 429}

    Number of calls: 0

    [0m [90m 304 |[39m             applyRateLimit(mockReq)[33m;[39m
     [90m 305 |[39m
    [31m[1m>[22m[39m[90m 306 |[39m             expect([33mNextResponse[39m[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 307 |[39m                 expect[33m.[39mobjectContaining({
     [90m 308 |[39m                     error[33m:[39m expect[33m.[39mstringContaining([32m'„É™„ÇØ„Ç®„Çπ„ÉàÊï∞„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Åæ„Åó„Åü'[39m)[33m,[39m
     [90m 309 |[39m                 })[33m,[39m[0m

      at Object.toHaveBeenCalledWith (__tests__/lib/api/utils.test.ts:306:39)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ parseJsonField ‚Ä∫ should return default for invalid JSON

    SyntaxError: Unexpected token 'o', "not json" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 144 |[39m         [33mRATE_LIMITS[39m[33m:[39m { api[33m:[39m { limit[33m:[39m [35m100[39m[33m,[39m window[33m:[39m [35m60[39m } }[33m,[39m
     [90m 145 |[39m         stringifyJsonField[33m:[39m (val[33m:[39m any) [33m=>[39m [33mJSON[39m[33m.[39mstringify(val)[33m,[39m
    [31m[1m>[22m[39m[90m 146 |[39m         parseJsonField[33m:[39m (val[33m:[39m any[33m,[39m fallback[33m:[39m any) [33m=>[39m val [33m?[39m [33mJSON[39m[33m.[39mparse(val) [33m:[39m fallback[33m,[39m
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 147 |[39m         errorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m status) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m msg }[33m,[39m { status }))[33m,[39m
     [90m 148 |[39m         serverErrorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m error) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m msg[33m,[39m details[33m:[39m error }[33m,[39m { status[33m:[39m [35m500[39m }))[33m,[39m
     [90m 149 |[39m         validationErrorResponse[33m:[39m jest[33m.[39mfn()[33m.[39mmockImplementation((msg[33m,[39m details) [33m=>[39m [33mNextResponse[39m[33m.[39mjson({ error[33m:[39m [32m'Validation Error'[39m[33m,[39m details[33m:[39m details [33m||[39m msg }[33m,[39m { status[33m:[39m [35m400[39m }))[33m,[39m[0m

      at parse (jest.setup.ts:146:65)
      at Object.<anonymous> (__tests__/lib/api/utils.test.ts:328:46)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ stringifyJsonField ‚Ä∫ should return null for null input

    expect(received).toBeNull()

    Received: "null"

    [0m [90m 349 |[39m             it([32m'should return null for null input'[39m[33m,[39m () [33m=>[39m {
     [90m 350 |[39m                 [36mconst[39m result [33m=[39m stringifyJsonField([36mnull[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 351 |[39m                 expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 352 |[39m             })[33m;[39m
     [90m 353 |[39m
     [90m 354 |[39m             it([32m'should return null for undefined input'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:351:32)

  ‚óè API Utils ‚Ä∫ JSONÂá¶ÁêÜÈñ¢Êï∞ ‚Ä∫ stringifyJsonField ‚Ä∫ should return null for undefined input

    expect(received).toBeNull()

    Received: undefined

    [0m [90m 354 |[39m             it([32m'should return null for undefined input'[39m[33m,[39m () [33m=>[39m {
     [90m 355 |[39m                 [36mconst[39m result [33m=[39m stringifyJsonField(undefined)[33m;[39m
    [31m[1m>[22m[39m[90m 356 |[39m                 expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 357 |[39m             })[33m;[39m
     [90m 358 |[39m         })[33m;[39m
     [90m 359 |[39m     })[33m;[39m[0m

      at Object.toBeNull (__tests__/lib/api/utils.test.ts:356:32)

FAIL __tests__/lib/formatters.test.ts
  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should format dates to ISO strings

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 31 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 32 |[39m
    [31m[1m>[22m[39m[90m 33 |[39m             expect(result[33m.[39mdate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 34 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 35 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m
     [90m 36 |[39m         })[33m;[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:33:33)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should parse JSON string fields to arrays

    expect(received).toEqual(expected) // deep equality

    Expected: ["worker1", "worker2"]
    Received: "[\"worker1\",\"worker2\"]"

    [0m [90m 50 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m             expect(result[33m.[39mworkers)[33m.[39mtoEqual([[32m'worker1'[39m[33m,[39m [32m'worker2'[39m])[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 53 |[39m             expect(result[33m.[39mvehicles)[33m.[39mtoEqual([[32m'vehicle1'[39m])[33m;[39m
     [90m 54 |[39m             expect(result[33m.[39mconfirmedWorkerIds)[33m.[39mtoEqual([[32m'confirmed1'[39m])[33m;[39m
     [90m 55 |[39m             expect(result[33m.[39mconfirmedVehicleIds)[33m.[39mtoEqual([[32m'vehicle2'[39m[33m,[39m [32m'vehicle3'[39m])[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:52:36)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should return empty arrays for null JSON fields

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 70 |[39m             [36mconst[39m result [33m=[39m formatAssignment(raw)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m             expect(result[33m.[39mworkers)[33m.[39mtoEqual([])[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 73 |[39m             expect(result[33m.[39mvehicles)[33m.[39mtoEqual([])[33m;[39m
     [90m 74 |[39m             expect(result[33m.[39mconfirmedWorkerIds)[33m.[39mtoEqual([])[33m;[39m
     [90m 75 |[39m             expect(result[33m.[39mconfirmedVehicleIds)[33m.[39mtoEqual([])[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:72:36)

  ‚óè Formatters ‚Ä∫ formatAssignment ‚Ä∫ should format nested projectMaster if present

    expect(received).toEqual(expected) // deep equality

    Expected: ["user1", "user2"]
    Received: "[\"user1\",\"user2\"]"

    [0m [90m  98 |[39m
     [90m  99 |[39m             expect(result[33m.[39mprojectMaster)[33m.[39mnot[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 100 |[39m             expect(result[33m.[39mprojectMaster[33m?[39m[33m.[39mcreatedBy)[33m.[39mtoEqual([[32m'user1'[39m[33m,[39m [32m'user2'[39m])[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 101 |[39m             expect(result[33m.[39mprojectMaster[33m?[39m[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 102 |[39m         })[33m;[39m
     [90m 103 |[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:100:53)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should format dates to ISO strings

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 160 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 161 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 162 |[39m             expect(result[33m.[39massemblyDate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 163 |[39m             expect(result[33m.[39mdemolitionDate)[33m.[39mtoBe([32m'2024-02-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 164 |[39m         })[33m;[39m
     [90m 165 |[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:162:41)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should handle null dates

    expect(received).toBeNull()

    Received: undefined

    [0m [90m 178 |[39m
     [90m 179 |[39m             expect(result[33m.[39massemblyDate)[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 180 |[39m             expect(result[33m.[39mdemolitionDate)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 181 |[39m         })[33m;[39m
     [90m 182 |[39m
     [90m 183 |[39m         it([32m'should parse createdBy JSON string'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeNull (__tests__/lib/formatters.test.ts:180:43)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should parse createdBy JSON string

    expect(received).toEqual(expected) // deep equality

    Expected: ["manager1", "manager2"]
    Received: "[\"manager1\",\"manager2\"]"

    [0m [90m 192 |[39m             [36mconst[39m result [33m=[39m formatProjectMaster(raw)[33m;[39m
     [90m 193 |[39m
    [31m[1m>[22m[39m[90m 194 |[39m             expect(result[33m.[39mcreatedBy)[33m.[39mtoEqual([[32m'manager1'[39m[33m,[39m [32m'manager2'[39m])[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 195 |[39m         })[33m;[39m
     [90m 196 |[39m
     [90m 197 |[39m         it([32m'should format nested assignments'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:194:38)

  ‚óè Formatters ‚Ä∫ formatProjectMaster ‚Ä∫ should format nested assignments

    expect(received).toBe(expected) // Object.is equality

    Expected: "2024-01-15T09:00:00.000Z"
    Received: 2024-01-15T09:00:00.000Z

    [0m [90m 219 |[39m
     [90m 220 |[39m             expect(result[33m.[39massignments)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m             expect(result[33m.[39massignments[33m?[39m[33m.[39m[[35m0[39m][33m.[39mdate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 222 |[39m             expect(result[33m.[39massignments[33m?[39m[33m.[39m[[35m0[39m][33m.[39mworkers)[33m.[39mtoEqual([[32m'w1'[39m])[33m;[39m
     [90m 223 |[39m         })[33m;[39m
     [90m 224 |[39m     })[33m;[39m[0m

      at Object.toBe (__tests__/lib/formatters.test.ts:221:50)

  ‚óè Formatters ‚Ä∫ formatEstimate ‚Ä∫ should format dates and parse items

    expect(received).toEqual(expected) // deep equality

    Expected: [{"amount": 1000, "description": "Item 1"}]
    Received: "[{\"description\":\"Item 1\",\"amount\":1000}]"

    [0m [90m 241 |[39m             [36mconst[39m result [33m=[39m formatEstimate(raw)[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([{ description[33m:[39m [32m'Item 1'[39m[33m,[39m amount[33m:[39m [35m1000[39m }])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 244 |[39m             expect(result[33m.[39mvalidUntil)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 245 |[39m             expect(result[33m.[39mcreatedAt)[33m.[39mtoBe([32m'2024-01-10T08:00:00.000Z'[39m)[33m;[39m
     [90m 246 |[39m             expect(result[33m.[39mupdatedAt)[33m.[39mtoBe([32m'2024-01-14T10:00:00.000Z'[39m)[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:243:34)

  ‚óè Formatters ‚Ä∫ formatEstimate ‚Ä∫ should return empty array for null items

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 258 |[39m             [36mconst[39m result [33m=[39m formatEstimate(raw)[33m;[39m
     [90m 259 |[39m
    [31m[1m>[22m[39m[90m 260 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 261 |[39m         })[33m;[39m
     [90m 262 |[39m
     [90m 263 |[39m         it([32m'should preserve numeric fields'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:260:34)

  ‚óè Formatters ‚Ä∫ formatInvoice ‚Ä∫ should format dates and parse items

    expect(received).toEqual(expected) // deep equality

    Expected: [{"amount": 2000, "description": "Service"}]
    Received: "[{\"description\":\"Service\",\"amount\":2000}]"

    [0m [90m 296 |[39m             [36mconst[39m result [33m=[39m formatInvoice(raw)[33m;[39m
     [90m 297 |[39m
    [31m[1m>[22m[39m[90m 298 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([{ description[33m:[39m [32m'Service'[39m[33m,[39m amount[33m:[39m [35m2000[39m }])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 299 |[39m             expect(result[33m.[39mdueDate)[33m.[39mtoBe([32m'2024-01-15T09:00:00.000Z'[39m)[33m;[39m
     [90m 300 |[39m             expect(result[33m.[39mpaidDate)[33m.[39mtoBe([32m'2024-01-20T10:00:00.000Z'[39m)[33m;[39m
     [90m 301 |[39m         })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:298:34)

  ‚óè Formatters ‚Ä∫ formatInvoice ‚Ä∫ should return empty array for null items

    expect(received).toEqual(expected) // deep equality

    Expected: []
    Received: null

    [0m [90m 328 |[39m             [36mconst[39m result [33m=[39m formatInvoice(raw)[33m;[39m
     [90m 329 |[39m
    [31m[1m>[22m[39m[90m 330 |[39m             expect(result[33m.[39mitems)[33m.[39mtoEqual([])[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 331 |[39m         })[33m;[39m
     [90m 332 |[39m     })[33m;[39m
     [90m 333 |[39m })[33m;[39m[0m

      at Object.toEqual (__tests__/lib/formatters.test.ts:330:34)


Test Suites: 3 failed, 38 passed, 41 total
Tests:       41 failed, 421 passed, 462 total
Snapshots:   0 total
Time:        5.494 s
Ran all test suites.
