# YuSystem SaaS化ロードマップ

## ゴール
複数の会社（テナント）が利用できるSaaSとして展開し、プラン別に機能・ユーザー数を制限して課金する。

---

## 現状 → SaaS化に必要な変更

| 現状 | SaaS化後 |
|------|----------|
| 単一組織 | マルチテナント（複数会社） |
| 全機能利用可 | プラン別機能制限 |
| ユーザー数制限なし | プラン別人数制限 |
| 課金なし | Stripe等で月額課金 |

---

## Phase 1: マルチテナント基盤（必須）

### 1.1 データベース設計
- `organizations` テーブル（会社情報）
- 全テーブルに `organization_id` 追加
- RLSポリシーをテナント単位に変更

### 1.2 認証・認可の変更
- ユーザーは組織に所属
- ログイン時に組織を特定
- セッションに `organizationId` を含める

---

## Phase 2: プラン・機能制限

### 2.1 プラン定義
```
| プラン | 月額 | 機能 | ユーザー数 |
|--------|------|------|-----------|
| Lite | ¥5,000 | スケジュールのみ | 5人 |
| Standard | ¥10,000 | +見積・請求 | 10人 |
| Pro | ¥20,000 | 全機能 | 無制限 |
```

### 2.2 DBテーブル
- `plans` - プラン定義
- `subscriptions` - 組織のサブスク状態
- `plan_features` - プラン別有効機能

### 2.3 機能フラグシステム
- ミドルウェアで機能制限チェック
- UIで無効機能をグレーアウト/非表示

---

## Phase 3: 課金システム（Stripe連携）

- Stripe Checkout でサブスク開始
- Webhook でサブスク状態を同期
- 請求書・領収書の自動生成

---

## Phase 4: 管理者向け機能

- テナント管理画面（プラン変更、ユーザー一覧）
- 利用状況ダッシュボード
- スーパー管理者用の全テナント管理画面

---

## 実装優先度

| 優先度 | 内容 | 工数目安 |
|--------|------|----------|
| 1 | マルチテナント基盤 | 2-3週間 |
| 2 | プラン・機能制限 | 1-2週間 |
| 3 | Stripe連携 | 1週間 |
| 4 | 管理者機能 | 1週間 |

---

## 確認事項

1. **プランの種類と価格設定**は上記の例で良いか？
2. **最初のテナント**は現在の御社データをそのまま移行？
3. **ドメイン戦略**: `会社名.yusystem.com` or `yusystem.com/会社ID`？
4. **決済手段**: Stripeで問題ないか？
