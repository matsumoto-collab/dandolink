# YuSystem SaaS化ロードマップ

## ゴール
複数の会社（テナント）が利用できるSaaSとして展開し、プラン別に機能・ユーザー数を制限して課金する。

---

## 現状 → SaaS化に必要な変更

| 現状 | SaaS化後 |
|------|----------|
| 単一組織 | マルチテナント（複数会社） |
| 全機能利用可 | プラン別機能制限 |
| ユーザー数制限なし | プラン別人数制限 |
| 課金なし | Stripe等で月額課金 |

---

## Phase 1: マルチテナント基盤（必須）

### 1.1 データベース設計
- `organizations` テーブル（会社情報）
- 全テーブルに `organization_id` 追加
- RLSポリシーをテナント単位に変更
- ⚠️ 将来的に大規模テナント向けDB分離の可能性も考慮

### 1.2 認証・認可の変更
- ユーザーは組織に所属
- ログイン時に組織を特定
- セッションに `organizationId` を含める
- 検討: Supabaseの組織機能も選択肢

### 1.3 ドメイン戦略（決定事項）
- **推奨**: `yusystem.com/会社ID` （証明書管理が簡単）
- 代替: `会社名.yusystem.com`（ブランディング向上だが証明書管理が複雑）

---

## Phase 2: プラン・機能制限

### 2.1 プラン定義
```
| プラン | 月額 | 機能 | ユーザー数 |
|--------|------|------|-----------|
| Lite | ¥5,000 | スケジュールのみ | 5人 |
| Standard | ¥10,000 | +見積・請求 | 10人 |
| Pro | ¥20,000 | 全機能 | 無制限 |
```

⚠️ **Liteプラン価格検討**: 競合との比較調査が必要

### 2.2 DBテーブル
- `plans` - プラン定義
- `subscriptions` - 組織のサブスク状態
- `plan_features` - プラン別有効機能

### 2.3 機能フラグシステム
- ミドルウェアで機能制限チェック
- UIで無効機能をグレーアウト/非表示

### 2.4 無料トライアル
- **14〜30日の無料期間**を提供（必須）
- トライアル終了後は自動でLiteプランに移行 or 機能制限

### 2.5 年払い割引
- 年払い: 月額×10ヶ月（2ヶ月分お得）

---

## Phase 3: 課金システム（Stripe連携）

- Stripe Checkout でサブスク開始
- Webhook でサブスク状態を同期
- 請求書・領収書の自動生成

---

## Phase 4: 管理者向け機能

- テナント管理画面（プラン変更、ユーザー一覧）
- 利用状況ダッシュボード
- スーパー管理者用の全テナント管理画面
- **テナントごとのデータエクスポート機能**

---

## Phase 5: 法務・運用整備

- **利用規約の整備**
- **プライバシーポリシーの整備**
- **退会時のデータ保持ポリシー**（30日保持後削除など）

---

## 実装優先度

| 優先度 | 内容 | 工数目安 |
|--------|------|----------|
| 1 | マルチテナント基盤 | 2-3週間 |
| 2 | プラン・機能制限 | 1-2週間 |
| 3 | Stripe連携 | 1週間 |
| 4 | 管理者機能 | 1週間 |
| 5 | 法務・運用整備 | 並行作業 |

---

## 確認事項

1. **プランの種類と価格設定**は上記の例で良いか？
2. **最初のテナント**は現在の御社データをそのまま移行？
3. ~~**ドメイン戦略**~~: → `yusystem.com/会社ID` を推奨
4. **決済手段**: Stripeで問題ないか？
5. **無料トライアル期間**: 14日 or 30日？

---

## レビューフィードバック（2026-01-19）

### 良い点
- Phase分けが適切（基盤→機能制限→課金→管理画面）
- プラン設計がシンプルで分かりやすい
- 工数見積もり（5-7週間）が現実的

### 検討完了
| 項目 | 当初案 | 決定 |
|------|--------|------|
| ドメイン戦略 | 未決定 | `yusystem.com/会社ID`（証明書管理が簡単） |
| 無料トライアル | 記載なし | 14〜30日の無料期間を追加 |
| 年払い割引 | 記載なし | 月額×10ヶ月で検討 |
| 追加機能 | - | データエクスポート、退会ポリシー追加 |

